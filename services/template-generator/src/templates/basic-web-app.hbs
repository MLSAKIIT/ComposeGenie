version: '3.8'

services:
  {{#each services}}
  {{name}}:
    image: {{image}}
    {{#if ports}}
    ports:
      {{#each ports}}
      - "{{this}}"
      {{/each}}
    {{/if}}
    {{#if environment}}
    environment:
      {{#each environment}}
      {{key}}: {{value}}
      {{/each}}
    {{/if}}
    {{#if volumes}}
    volumes:
      {{#each volumes}}
      - {{this}}
      {{/each}}
    {{/if}}
    {{#if depends_on}}
    depends_on:
      {{#each depends_on}}
      - {{this}}
      {{/each}}
    {{/if}}
    {{#if networks}}
    networks:
      {{#each networks}}
      - {{this}}
      {{/each}}
    {{/if}}
    restart: {{restart_policy}}

  {{/each}}

{{#if volumes}}
volumes:
  {{#each volumes}}
  {{name}}:
    driver: {{driver}}
    {{#if external}}
    external: {{external}}
    {{/if}}
  {{/each}}
{{/if}}

{{#if networks}}
networks:
  {{#each networks}}
  {{name}}:
    driver: {{driver}}
    {{#if external}}
    external: {{external}}
    {{/if}}
  {{/each}}
{{/if}}